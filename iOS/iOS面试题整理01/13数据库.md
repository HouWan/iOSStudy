
## 十三.数据库
 
### 13.1 数据库简介
**SQLite** 是在世界上使用的最多的数据库引擎，并且还是开源的。它实现了无配置，无服务要求的事务数据库引擎。

**FMDB框架**封装了对SQLite的调用，使用时需要导入`libsqlite3.0.dylib`

**Core Data** 是App开发者可以使用的第二大主要的iOS存储技术。它相比SQLite更加关注于对象，而非传统的表数据库方法。

**Realm** 专为移动平台开发的跨平台数据库，有自己的持久化引擎。

### 13.2 基本SQL语句
```sql
-- 1.插入数据
insert into students (name, age, sex) values ("小强", 16, 1); -- 性别1是枚举下标值

-- 2.修改一条数据
update students set age=5, name="么么哒" where id=4;

-- 3.查询
select name, age from students where id<10;

-- 4.使用as给字段起别名
-- select 字段1 as 名字...from 表名;
select name as '姓名', age as '年龄' from students;

-- 5.交集 inner join
-- 查询 每个学生对应的班级信息
select * from students inner join classes on students.cls_id = classes.id;

-- 6.左连接 left join
-- 查询每位学生对应的班级信息
select * from students as s left join classes as c on s.cls_id = c.id;

-- 7.子查询
-- 查询年龄最大的男生信息
select * from students where age = (
	select max(age) from students where gender = "男"
);
```

**A.简单描述下客户端的缓存机制？**
1.缓存可以分为：内存数据缓存、数据库缓存、文件缓存
2.每次想获取数据的时候
3.先检测内存中有无缓存
4.再检测本地有无缓存(数据库\文件)
5.服务器返回的网络数据进行缓存（内存、数据库、文件），以
便下次读取

**B.什么是序列化和反序列化，用来做什么**
序列化把对象转化为字节序列的过程
反序列化把直接序列恢复成对象
一般是把对象写到文件或者数据库中，并且读取出来

**C.OC中实现复杂对象的存储**
OC的是遵循`NSCoding`协议，实现复杂对象的存储，实现该协议后可以对其进行打包或者解包，转化为`NSDate`。
在Swift中，是遵循`Codable`协议。

**D.iOS中常用的数据存储方式有哪些？**

1.数据存储有四种方案，`NSUserDefault`,`KeyChain`,File文件,DB数据库。
2.其中File文件有三种方式：`plist`,`Archiver`归档解档,`Stream`二进制文件
DB包括`core Data`和`FMDB`(SQLite)

**E.你会如何存储用户的一些敏感信息，如登录的token?**
1.使用`keychain`来存储,也就是**钥匙串**,使用`keychain`需要导入`Security.kit`框架
2.也和用户信息进行文件存储过，为了安全，会进行Data数据进行加密，并迷惑文件名，比如`logo.jpg`.

**F.加密MD5和Base64的区别是什么，各自使用场景是什么？**
**MD5**：是一种不可逆的摘要算法，用于生成摘要，无法逆着破解得到原文。常用的是生成32位摘要，用于验证数据的有效性。比如，在网络请求接口中，通过将所有的参数生成摘要，客户端和服务端采用同样的规则生成摘要，这样可以防篡改。又如，下载文件时，通过生成文件的摘要，用于验证文件是否损坏。
单向哈希算法，比如SDWebimage的文件名。

**Base64**：属于加密算法，是可逆的，经过`encode`后，可以`decode`得到原文。在开发中，有的公司上传图片采用的是将图片转换成base64字符串，再上传。在做加密相关的功能时，通常会将数据进行`base64`加密/解密。

**G.plist文件是用来做什么的。一般用它来处理一些什么方面的问题？**
plist是iOS系统中特有的文件格式。我们常用的`NSUserDefaults`偏好设置实质上就是plist文件操作。plist文件是用来持久化存储数据的。

我们通常使用它来存储偏好设置，以及那些少量的、数组结构比较复杂的不适合存储数据库的数据。对于系统的`NSUserDefaults`比如存登录状态，App今天是否显示过弹框广告之类的。

对于单独的plist文件，比如存储固定的权限map表，城市和id表，当然也可以用json文件。

**F.当存储大块数据是怎么做？**
可以根据数据的类型，比如是小视频，或者下载的文件，最还是File文件即可，注意的是异步的读写。

**1.事务四大特性**
事务简单来说：一个Session中所进行所有的操作，要么同时成功，要么同时失败.
原子性:Atomicity，要么执行，要么不执行
隔离性:Consistency，所有操作全部执行完以前其它会话不能看到过程
一致性:Isolation，事务前后，数据总额一致
持久性:Durability，一旦事务提交，对数据的改变就是永久的

**2.索引有B+索引和hash索引**
hash索引，等值查询效率高，不能排序,不能进行范围查询
B+索引数据有序,范围查询

B+树是一个平衡的多叉树，从根节点到每个叶子节点的高度差值不超过1,而且同层级的节点间有指针相互链接，是有序的。

哈希索引就是采用一定的哈希算法，把键值换算成新的哈希值，检索时不需要类似B+树那样从根节点到叶子节点逐级查找，只需一次哈希算法即可,是无序的

https://database.51cto.com/art/202010/628634.htm

**3.哈希索引的优势**
等值查询，哈希索引具有绝对优势(前提是:没有大量重复键值，如果大量重复键值时，哈希索引的效率很低，因为存在所谓的哈希碰撞问题(哈希冲突)

哈希索引不适用的场景：
不支持范围查询，不支持索引完成排序，不支持联合索引的最左前缀匹配规则

**4.索引的优缺点，什么时候使用索引，什么时候不能使用索引**
索引最大的好处是提高查询速度，
缺点是更新数据时效率低，因为要同时更新索引
对数据进行频繁查询进建立索引，如果要频繁更改数据不建议使用索引。

注意，索引的底层实现是B+树。

**5.Sql的优化**
sql尽量使用索引,而且查询要走索引
子查询变成left join
避免嵌套查询
合理使用`char`和`varchar`
`varchar`:字符长度经常变的；`char`用字符长度固定的

**6.非关系型数据库**
使用键值对存储数据；分布式。
优点
无需经过sql层的解析，读写性能很高
基于键值对，数据没有耦合性，容易扩展
存储数据的格式：nosql的存储格式是key,value形式
缺点
不提供sql支持

**7.数据库中join的left join , inner join, cross join**
1.以A，B两张表为例
`A left join B`
选出A的所有记录，B表中没有的以`null`代替
`right join` 同理

2.`inner join`
A,B有交集的记录

3.`cross join` (笛卡尔积)
A中的每一条记录和B中的每一条记录生成一条记录
例如A中有4条，B中有4条，`cross join`就有16条记录

**8.建数据表的要求？**
满足三个范式，满足着第三范式，那么就一定满足第二范式、满足着第二范式就一定满足第一范式。
第一范式：字段是最小的的单元不可再分
第二范式：满足第一范式,表中的字段必须完全依赖于全部主键而非部分主键。
第三范式：满足第二范式，非主键外的所有字段必须互不依赖

**9.什么是视图？以及视图的使用场景有哪些？**
视图是一种基于数据表的一种**虚表**
- 视图建立在已有表的基础上, 视图赖以建立的这些表称为基表
- 视图没有存储真正的数据，真正的数据还是存储在基表中
- 程序员虽然操作的是视图，但最终视图还会转成操作基表
- 一个基表可以有0个或多个视图
